import e,{useLayoutEffect as t,useEffect as r,forwardRef as o,useRef as n,useImperativeHandle as i,useMemo as l,Fragment as a,cloneElement as s,Component as c,startTransition as u,useState as d,useCallback as h}from"react";import{useThree as p,invalidate as g,useFrame as m,Canvas as f,createPortal as v,useLoader as w,addEffect as b}from"@react-three/fiber";import{ResizeObserver as y}from"@juggle/resize-observer";import{parse as S}from"query-string";import R from"zustand";import{Vector2 as E,Scene as C,MathUtils as T,DefaultLoadingManager as I,TextureLoader as O,ImageBitmapLoader as M,Texture as L,CanvasTexture as k}from"three";import{useInView as x}from"react-intersection-observer";import V from"debounce";import P from"vecn";import{suspend as _}from"suspend-react";import D from"supports-webp";import A from"fast-deep-equal";import U from"lenis";function j(){return j=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)({}).hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},j.apply(null,arguments)}function Y(e,t){if(null==e)return{};var r={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(t.includes(o))continue;r[o]=e[o]}return r}function z(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}const B="undefined"!=typeof window?t:r,F={PRIORITY_PRELOAD:0,PRIORITY_SCISSORS:1,PRIORITY_VIEWPORTS:1,PRIORITY_GLOBAL:1e3,DEFAULT_SCALE_MULTIPLIER:1,preloadQueue:[]},q=R(e=>({debug:!1,scaleMultiplier:F.DEFAULT_SCALE_MULTIPLIER,globalRender:!0,globalPriority:F.PRIORITY_GLOBAL,globalClearDepth:!1,globalRenderQueue:!1,clearGlobalRenderQueue:()=>e(()=>({globalRenderQueue:!1})),isCanvasAvailable:!1,hasSmoothScrollbar:!1,canvasChildren:{},renderToCanvas:(t,r,o={})=>e(({canvasChildren:e})=>Object.getOwnPropertyDescriptor(e,t)?(e[t].instances+=1,e[t].props.inactive=!1,{canvasChildren:e}):{canvasChildren:j({},e,{[t]:{mesh:r,props:o,instances:1}})}),updateCanvas:(t,r)=>e(({canvasChildren:e})=>{if(!e[t])return;const{[t]:{mesh:o,props:n,instances:i}}=e;return{canvasChildren:j({},e,{[t]:{mesh:o,props:j({},n,r),instances:i}})}}),removeFromCanvas:(t,r=!0)=>e(({canvasChildren:e})=>{var o;return(null==(o=e[t])?void 0:o.instances)>1?(e[t].instances-=1,{canvasChildren:e}):r?{canvasChildren:Y(e,[t].map(z))}:(e[t].instances=0,e[t].props.inactive=!0,{canvasChildren:j({},e)})}),pageReflow:0,requestReflow:()=>{e(e=>({pageReflow:e.pageReflow+1}))},scroll:{y:0,x:0,limit:0,velocity:0,progress:0,direction:0,scrollDirection:void 0},__lenis:void 0,scrollTo:()=>{},onScroll:()=>()=>{}})),Q=()=>{const e=q(e=>e.requestReflow),t=q(e=>e.debug);return r(()=>{let r=new(window.ResizeObserver||y)(()=>{e(),t&&console.log("ResizeManager","document.body height changed")});return r.observe(document.body),()=>{null==r||r.disconnect()}},[]),null},W=["makeDefault","margin"],G=o((t,r)=>{let{makeDefault:o=!1,margin:a=0}=t,s=Y(t,W);const c=p(e=>e.set),u=p(e=>e.camera),d=p(e=>e.size),h=p(e=>e.viewport),g=n(null);i(r,()=>g.current);const m=q(e=>e.pageReflow),f=q(e=>e.scaleMultiplier),{fov:v,distance:w,aspect:b}=l(()=>{var e;const t=(d.height+2*a)*f,r=(d.width+2*a)*f/t;let o=s.fov||50,n=null==s||null==(e=s.position)?void 0:e[2];return n?o=180/Math.PI*2*Math.atan(t/(2*n)):n=t/(2*Math.tan(o/2*Math.PI/180)),{fov:o,distance:n,aspect:r}},[d,f,m]);return B(()=>{g.current.lookAt(0,0,0),g.current.updateProjectionMatrix(),g.current.updateMatrixWorld(),c(e=>({viewport:j({},e.viewport,h.getCurrentViewport(u))}))},[d,f,m]),B(()=>{if(o){const e=u;return c(()=>({camera:g.current})),()=>c(()=>({camera:e}))}},[g,o,c]),e.createElement("perspectiveCamera",j({ref:g,position:[0,0,w],onUpdate:e=>e.updateProjectionMatrix(),near:.1,aspect:b,fov:v,far:2*w},s))}),H=["makeDefault","margin"],X=o((t,r)=>{let{makeDefault:o=!1,margin:a=0}=t,s=Y(t,H);const c=p(e=>e.set),u=p(e=>e.camera),d=p(e=>e.size),h=q(e=>e.pageReflow),g=q(e=>e.scaleMultiplier),m=l(()=>Math.max(d.width*g,d.height*g),[d,h,g]),f=n(null);return i(r,()=>f.current),B(()=>{f.current.lookAt(0,0,0),f.current.updateProjectionMatrix(),f.current.updateMatrixWorld()},[m,d]),B(()=>{if(o){const e=u;return c(()=>({camera:f.current})),()=>c(()=>({camera:e}))}},[f,o,c]),e.createElement("orthographicCamera",j({left:d.width*g/-2-a*g,right:d.width*g/2+a*g,top:d.height*g/2+a*g,bottom:d.height*g/-2-a*g,far:2*m,position:[0,0,m],near:.001,ref:f,onUpdate:e=>e.updateProjectionMatrix()},s))});function N(e,t){e&&(!1===t?(e.wasFrustumCulled=e.frustumCulled,e.wasVisible=e.visible,e.visible=!0,e.frustumCulled=!1):(e.visible=!!e.wasVisible,e.frustumCulled=!!e.wasFrustumCulled),e.children.forEach(e=>N(e,t)))}const J=new E,K=(e=[0])=>{q.getState().globalRenderQueue=q.getState().globalRenderQueue||[0],q.getState().globalRenderQueue=[...q.getState().globalRenderQueue||[],...e]},Z=({gl:e,scene:t,camera:r,left:o,top:n,width:i,height:l,layer:a=0,autoClear:s=!1,clearDepth:c=!1})=>{t&&r&&(e.autoClear=s,e.setScissor(o,n,i,l),e.setScissorTest(!0),r.layers.set(a),c&&e.clearDepth(),e.render(t,r),e.setScissorTest(!1))},$=({gl:e,scene:t,camera:r,left:o,top:n,width:i,height:l,layer:a=0,scissor:s=!0,autoClear:c=!1,clearDepth:u=!1})=>{t&&r&&(e.getSize(J),e.autoClear=c,e.setViewport(o,n,i,l),e.setScissor(o,n,i,l),e.setScissorTest(s),r.layers.set(a),u&&e.clearDepth(),e.render(t,r),e.setScissorTest(!1),e.setViewport(0,0,J.x,J.y))},ee=({scene:e,camera:t,layer:r=0},o)=>{F.preloadQueue.push((n,i,l)=>{n.setScissorTest(!1),N(e||i,!1),(t||l).layers.set(r),n.render(e||i,t||l),N(e||i,!0),o&&o()}),g()},te=()=>{const e=q(e=>e.isCanvasAvailable),t=q(e=>e.hasSmoothScrollbar),o=q(e=>e.requestReflow),n=q(e=>e.pageReflow),i=q(e=>e.debug),l=q(e=>e.scaleMultiplier);return r(()=>{i&&(window._scrollRig=window._scrollRig||{},window._scrollRig.reflow=o)},[]),{debug:i,isCanvasAvailable:e,hasSmoothScrollbar:t,scaleMultiplier:l,preloadScene:ee,requestRender:K,renderScissor:Z,renderViewport:$,reflow:o,reflowCompleted:n}},re=({children:t})=>{const o=p(e=>e.gl),n=q(e=>e.canvasChildren),i=te();return r(()=>{Object.keys(n).length||(i.debug&&console.log("GlobalRenderer","auto render empty canvas"),o.clear(),i.requestRender(),g())},[n]),i.debug&&console.log("GlobalChildren",Object.keys(n).length),e.createElement(e.Fragment,null,t,Object.keys(n).map(t=>{const{mesh:r,props:o}=n[t];return"function"==typeof r?e.createElement(a,{key:t},r(j({key:t},i,o))):s(r,j({key:t},o))}))},oe=()=>{const e=p(e=>e.gl),t=p(e=>e.frameloop),r=q(e=>e.globalClearDepth),o=q(e=>e.globalPriority),n=te();return B(()=>{e.debug.checkShaderErrors=n.debug},[n.debug]),m(({camera:t,scene:r})=>{F.preloadQueue.length&&(F.preloadQueue.forEach(o=>o(e,r,t)),e.clear(),F.preloadQueue=[],n.debug&&console.log("GlobalRenderer","preload complete. trigger global render"),n.requestRender(),g())},F.PRIORITY_PRELOAD),m(({camera:o,scene:n})=>{const i=q.getState().globalRenderQueue;("always"===t||i)&&(o.layers.disableAll(),i?i.forEach(e=>{o.layers.enable(e)}):o.layers.enable(0),r&&e.clearDepth(),e.render(n,o)),q.getState().clearGlobalRenderQueue()},o),null};class ne extends c{constructor(e){super(e),this.state={error:!1},this.props=e}static getDerivedStateFromError(e){return{error:e}}render(){return this.state.error?(this.props.onError&&this.props.onError(this.state.error),null):this.props.children}}var ie="8.14.0";const le=["children","as","gl","useWebGPU","style","orthographic","camera","debug","scaleMultiplier","globalRender","globalPriority","globalClearDepth"],ae=["children","onError"];let se;"undefined"!=typeof window&&(se=window.ResizeObserver||y);const ce=t=>{let{children:r,as:o=f,gl:n,useWebGPU:i,style:l,orthographic:a,camera:s,debug:c,scaleMultiplier:d=F.DEFAULT_SCALE_MULTIPLIER,globalRender:h=!0,globalPriority:p=F.PRIORITY_GLOBAL,globalClearDepth:g=!1}=t,m=Y(t,le);const v=q(e=>e.globalRender);return B(()=>{"undefined"!=typeof window&&(window.__r3f_scroll_rig=ie);const e=S(window.location.search);(c||void 0!==e.debug)&&(q.setState({debug:!0}),console.info("@14islands/r3f-scroll-rig@"+ie))},[c]),B(()=>{u(()=>{q.setState({scaleMultiplier:d,globalRender:h,globalPriority:p,globalClearDepth:g})})},[d,p,h,g]),e.createElement(o,j({id:"ScrollRig-canvas",camera:{manual:!0},gl:i?n:j({failIfMajorPerformanceCaveat:!0},n),resize:{scroll:!1,debounce:0,polyfill:se},style:j({position:"fixed",top:0,left:0,right:0,height:"100vh"},l)},m),!a&&e.createElement(G,j({manual:!0,makeDefault:!0},s)),a&&e.createElement(X,j({manual:!0,makeDefault:!0},s)),v&&e.createElement(oe,null),"function"==typeof r?r(e.createElement(re,null)):e.createElement(re,null,r),e.createElement(Q,null))},ue=t=>{let{children:r,onError:o}=t,n=Y(t,ae);return B(()=>{document.documentElement.classList.add("js-has-global-canvas"),q.setState({isCanvasAvailable:!0})},[]),e.createElement(ne,{onError:e=>{o&&o(e),q.setState({isCanvasAvailable:!1}),document.documentElement.classList.remove("js-has-global-canvas"),document.documentElement.classList.add("js-global-canvas-error")}},e.createElement(ce,j({},n),r),e.createElement("noscript",null,e.createElement("style",null,"\n          .ScrollRig-visibilityHidden,\n          .ScrollRig-transparentColor {\n            visibility: unset;\n            color: unset;\n          }\n          ")))},de=({scale:t})=>e.createElement("mesh",{scale:t},e.createElement("planeGeometry",null),e.createElement("meshBasicMaterial",{color:"hotpink",opacity:.5,transparent:!0})),he="undefined"!=typeof window;function pe({debounce:e=0}={}){const[t,o]=d({width:he?window.innerWidth:Infinity,height:he?window.innerHeight:Infinity});return r(()=>{const r=document.getElementById("ScrollRig-canvas");function n(){const e=r?r.clientWidth:window.innerWidth,n=r?r.clientHeight:window.innerHeight;e===t.width&&n===t.height||o({width:e,height:n})}const i=V.debounce(n,e),l=window.ResizeObserver||y;let a;return r?(a=new l(i),a.observe(r)):window.addEventListener("resize",i),n(),()=>{var e;window.removeEventListener("resize",i),null==(e=a)||e.disconnect()}},[t,o]),t}function ge(e,t,r,o,n){return o+(e-t)*(n-o)/(r-t)}const me=()=>({enabled:q(e=>e.hasSmoothScrollbar),scroll:q(e=>e.scroll),scrollTo:q(e=>e.scrollTo),onScroll:q(e=>e.onScroll),__lenis:q(e=>e.__lenis)});function fe(e,t){const o=pe(),{scroll:i,onScroll:a}=me(),s=q(e=>e.scaleMultiplier),c=q(e=>e.pageReflow),u=q(e=>e.debug),{rootMargin:p,threshold:g,autoUpdate:m,wrapper:f}=l(()=>{const e={rootMargin:"0%",threshold:0,autoUpdate:!0},r=t||{};return Object.keys(r).map((t,o)=>{void 0!==r[t]&&(e[t]=r[t])}),e},[t]),{ref:v,inView:w}=x({rootMargin:p,threshold:g});B(()=>{v(e.current)},[e,null==e?void 0:e.current]);const[b,y]=d(P.vec3(0,0,0)),S=n({inViewport:!1,progress:-1,visibility:-1,viewport:-1}).current,R=n({top:0,bottom:0,left:0,right:0,width:0,height:0}).current,[E,C]=d(R),T=n({top:0,bottom:0,left:0,right:0,width:0,height:0,x:0,y:0,positiveYUpBottom:0}).current,I=n(P.vec3(0,0,0)).current;B(()=>{var t;const r=null==(t=e.current)?void 0:t.getBoundingClientRect();if(!r)return;const n=f?f.scrollTop:window.scrollY,i=f?f.scrollLeft:window.scrollX;R.top=r.top+n,R.bottom=r.bottom+n,R.left=r.left+i,R.right=r.right+i,R.width=r.width,R.height=r.height,C(j({},R)),y(P.vec3((null==R?void 0:R.width)*s,(null==R?void 0:R.height)*s,1)),u&&console.log("useTracker.getBoundingClientRect:",R,"intialScroll:",{initialY:n,initialX:i},"size:",o,"pageReflow:",c)},[e,o,c,s,u]);const O=h(({onlyUpdateInViewport:t=!1,scroll:r}={})=>{if(!e.current||t&&!S.inViewport)return;const n=r||i;!function(e,t,r,o){e.top=t.top-(r.y||0),e.bottom=t.bottom-(r.y||0),e.left=t.left-(r.x||0),e.right=t.right-(r.x||0),e.width=t.width,e.height=t.height,e.x=e.left+.5*t.width-.5*o.width,e.y=e.top+.5*t.height-.5*o.height,e.positiveYUpBottom=o.height-e.bottom}(T,R,n,o),function(e,t,r){e.x=t.x*r,e.y=-1*t.y*r}(I,T,s);const l="horizontal"===n.scrollDirection,a=l?"width":"height",c=o[a]-T[l?"left":"top"];S.progress=ge(c,0,o[a]+T[a],0,1),S.visibility=ge(c,0,T[a],0,1),S.viewport=ge(c,0,o[a],0,1)},[e,o,s,i]);return B(()=>{S.inViewport=w,O({onlyUpdateInViewport:!1}),u&&console.log("useTracker.inViewport:",w,"update()")},[w]),B(()=>{O({onlyUpdateInViewport:!1}),u&&console.log("useTracker.update on resize/reflow")},[O,c]),r(()=>{if(m)return a(e=>O({onlyUpdateInViewport:!0}))},[m,O,a]),{scale:b,inViewport:w,rect:E,bounds:T,position:I,scrollState:S,update:O}}const ve=["track","children","margin","inViewportMargin","inViewportThreshold","visible","hideOffscreen","scissor","debug","as","priority","scene"];function we(t){let{track:o,children:i,margin:l=0,inViewportMargin:a,inViewportThreshold:s,visible:c=!0,hideOffscreen:u=!0,scissor:h=!1,debug:g=!1,as:f="scene",priority:w=F.PRIORITY_SCISSORS,scene:b}=t,y=Y(t,ve);const S=p(e=>e.scene),R=n(null),[E]=d(b||(h?new C:null)),{requestRender:T,renderScissor:I}=te(),O=q(e=>e.globalRender),{bounds:M,scale:L,position:k,scrollState:x,inViewport:V}=fe(o,{rootMargin:a,threshold:s});B(()=>{R.current&&(R.current.visible=u?V&&c:c)},[V,u,c]),r(()=>{R.current&&(R.current.position.y=k.y,R.current.position.x=k.x)},[L,V]),m(({gl:e,camera:t})=>{R.current&&R.current.visible&&(R.current.position.y=k.y,R.current.position.x=k.x,h?I({gl:e,portalScene:E,camera:t,left:M.left-l,top:M.positiveYUpBottom-l,width:M.width+2*l,height:M.height+2*l}):T())},O?w:void 0);const P=e.createElement(f,{ref:R},(!i||g)&&L&&e.createElement(de,{scale:L}),i&&L&&i(j({track:o,margin:l,scene:E||S,scale:L,scrollState:x,inViewport:V,priority:w},y)));return E?v(P,E):P}const be=["track","children","margin","inViewportMargin","inViewportThreshold","visible","hideOffscreen","scissor","debug","as","priority","scene"];function ye(t){let{track:o,children:i,margin:a=0,inViewportMargin:s,inViewportThreshold:c,visible:u=!0,hideOffscreen:h=!0,scissor:g=!1,debug:f=!1,as:w="scene",priority:b=F.PRIORITY_SCISSORS,scene:y}=t,S=Y(t,be);const R=p(e=>e.scene),E=n(null),[T]=d(y||(g?new C:null)),{requestRender:I,renderScissor:O}=te(),M=q(e=>e.globalRender),{bounds:L,scale:k,position:V,scrollState:_,inViewport:D}=function(e,t){const r=pe(),{scroll:o}=me(),i=q(e=>e.scaleMultiplier),a=q(e=>e.pageReflow),s=q(e=>e.debug),{rootMargin:c,threshold:u,wrapper:h}=l(()=>{const e={rootMargin:"0%",threshold:0,autoUpdate:!0},r=t||{};return Object.keys(r).map((t,o)=>{void 0!==r[t]&&(e[t]=r[t])}),e},[t]),{ref:p,inView:g}=x({rootMargin:c,threshold:u});B(()=>{p(e.current)},[e,null==e?void 0:e.current]);const[f,v]=d(P.vec3(0,0,0)),w=n({inViewport:!1,progress:-1,visibility:-1,viewport:-1}).current,b=n({top:0,bottom:0,left:0,right:0,width:0,height:0}).current,[y,S]=d(b),R=n({top:0,bottom:0,left:0,right:0,width:0,height:0,x:0,y:0,positiveYUpBottom:0}).current,E=n(P.vec3(0,0,0)).current;return m(()=>{var t;const n=null==(t=e.current)?void 0:t.getBoundingClientRect();if(!n)return;const l=h?h.scrollTop:window.scrollY,c=h?h.scrollLeft:window.scrollX;b.top=n.top+l,b.bottom=n.bottom+l,b.left=n.left+c,b.right=n.right+c,b.width=n.width,b.height=n.height,S(j({},b)),v(P.vec3((null==b?void 0:b.width)*i,(null==b?void 0:b.height)*i,1)),s&&console.log("useTrackerFrame.getBoundingClientRect:",b,"intialScroll:",{initialY:l,initialX:c},"size:",r,"pageReflow:",a);const u=o;!function(e,t,r,o){e.top=t.top-(r.y||0),e.bottom=t.bottom-(r.y||0),e.left=t.left-(r.x||0),e.right=t.right-(r.x||0),e.width=t.width,e.height=t.height,e.x=e.left+.5*t.width-.5*o.width,e.y=e.top+.5*t.height-.5*o.height,e.positiveYUpBottom=o.height-e.bottom}(R,b,u,r),function(e,t,r){e.x=t.x*r,e.y=-1*t.y*r}(E,R,i);const d="horizontal"===u.scrollDirection,p=d?"width":"height",g=r[p]-R[d?"left":"top"];w.progress=ge(g,0,r[p]+R[p],0,1),w.visibility=ge(g,0,R[p],0,1),w.viewport=ge(g,0,r[p],0,1)}),{scale:f,inViewport:g,rect:y,bounds:R,position:E,scrollState:w}}(o,{rootMargin:s,threshold:c});B(()=>{E.current&&(E.current.visible=h?D&&u:u)},[D,h,u]),r(()=>{E.current&&(E.current.position.y=V.y,E.current.position.x=V.x)},[k,D]),m(({gl:e,camera:t})=>{E.current&&E.current.visible&&(E.current.position.y=V.y,E.current.position.x=V.x,g?O({gl:e,portalScene:T,camera:t,left:L.left-a,top:L.positiveYUpBottom-a,width:L.width+2*a,height:L.height+2*a}):I())},M?b:void 0);const A=e.createElement(w,{ref:E},(!i||f)&&k&&e.createElement(de,{scale:k}),i&&k&&i(j({track:o,margin:a,scene:T||R,scale:k,scrollState:_,inViewport:D,priority:b},S)));return T?v(A,T):A}const Se=["track","children","margin","visible","hideOffscreen","debug","orthographic","priority","inViewport","bounds","scale","scrollState","camera","hud","position","rect"],Re=["track","margin","inViewportMargin","inViewportThreshold","priority"],Ee=["bounds"],Ce=t=>{let{track:o,children:n,margin:i=0,visible:l=!0,hideOffscreen:a=!0,debug:s=!1,orthographic:c=!1,priority:u=F.PRIORITY_VIEWPORTS,inViewport:d,bounds:h,scale:g,scrollState:f,camera:v,hud:w}=t,b=Y(t,Se);const y=p(e=>e.scene),S=p(e=>e.get),R=p(e=>e.setEvents),{renderViewport:E}=te();return B(()=>{y.visible=a?d&&l:l},[d,a,l]),r(()=>{const e=S().events.connected;return R({connected:o.current}),()=>R({connected:e})},[]),m(({gl:e,scene:t,camera:r})=>{t.visible&&E({gl:e,scene:t,camera:r,left:h.left-i,top:h.positiveYUpBottom-i,width:h.width+2*i,height:h.height+2*i,clearDepth:!!w})},u),e.createElement(e.Fragment,null,!c&&e.createElement(G,j({manual:!0,margin:i,makeDefault:!0},v)),c&&e.createElement(X,j({manual:!0,margin:i,makeDefault:!0},v)),(!n||s)&&g&&e.createElement(de,{scale:g}),n&&g&&n(j({track:o,margin:i,scale:g,scrollState:f,inViewport:d,priority:u},b)))};function Te(t){let{track:r,margin:o=0,inViewportMargin:n,inViewportThreshold:i,priority:l}=t,a=Y(t,Re);const[s]=d(()=>new C),c=fe(r,{rootMargin:n,threshold:i}),{bounds:u}=c,p=Y(c,Ee),g=h((e,t)=>{if(r.current&&e.target===r.current){const{width:r,height:n,left:i,top:l}=u;t.pointer.set((e.clientX-i+o)/(r+2*o)*2-1,-(e.clientY-l+o)/(n+2*o)*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}},[u]);return u&&v(e.createElement(Ce,j({track:r,bounds:u,priority:l,margin:o},a,p)),s,{events:{compute:g,priority:l},size:{width:u.width,height:u.height}})}function Ie(e,t={},{key:o,dispose:n=!0}={}){const i=q(e=>e.updateCanvas),a=q(e=>e.renderToCanvas),s=q(e=>e.removeFromCanvas),c=l(()=>o||T.generateUUID(),[]);B(()=>{a(c,e,j({},t,{inactive:!1}))},[c]),r(()=>()=>{s(c,n)},[c]);const u=h(e=>{i(c,e)},[i,c]);return r(()=>{u(t)},[...Object.values(t)]),u}const Oe=["children","id","dispose"],Me=o((e,t)=>{let{children:r,id:o,dispose:n=!0}=e,i=Y(e,Oe);return r?(Ie(r,j({},i,{id:o,ref:t}),{key:o,dispose:n}),null):null});let Le=!1;function ke(e,{initTexture:t=!0,premultiplyAlpha:o="default"}={}){var n,i;const a=p(e=>e.gl),s=pe(),c=q(e=>e.debug),[u,h]=d(null==(n=e.current)?void 0:n.currentSrc);r(()=>{const t=e.current,r=()=>{var t;h(null==(t=e.current)?void 0:t.currentSrc)};return null==t||t.addEventListener("load",r),()=>null==t?void 0:t.removeEventListener("load",r)},[e,u,h]);const g=_(()=>(I.itemStart("waiting for DOM image"),new Promise(t=>{const r=e.current;function o(){t(null==r?void 0:r.currentSrc),I.itemEnd("waiting for DOM image")}null==r||r.addEventListener("load",o,{once:!0}),null!=r&&r.complete&&(null==r||r.removeEventListener("load",o),o())})),[e,s,null==(i=e.current)?void 0:i.currentSrc,u],{equal:A}),m=function(){const e=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),t=navigator.userAgent.indexOf("Firefox")>-1,r=t?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;return"undefined"==typeof createImageBitmap||e||t&&Number(r)<98}()?O:M,f=w(m,g,e=>{e instanceof M&&(e.setOptions({colorSpaceConversion:"none",premultiplyAlpha:o,imageOrientation:"flipY"}),e.setRequestHeader({Accept:(Le?"image/webp,":"")+"*/*"}))}),v=l(()=>f instanceof L?f:f instanceof ImageBitmap?new k(f):void 0,[f]);return r(function(){t&&a.initTexture(v),c&&console.log("useImageAsTexture","initTexture()")},[a,v,t]),v}D.then(e=>{Le=e});const xe=o(({children:e,enabled:t=!0,locked:o=!1,scrollRestoration:l="auto",disablePointerOnScroll:a=!0,horizontal:s=!1,scrollInContainer:c=!1,updateGlobalState:u=!0,onScroll:d,config:p={},invalidate:g=()=>{},addEffect:m},f)=>{const v=n(void 0),w=n(!1),b=q(e=>e.scroll);i(f,()=>({start:()=>{var e;return null==(e=v.current)?void 0:e.start()},stop:()=>{var e;return null==(e=v.current)?void 0:e.stop()},on:(e,t)=>{var r;return null==(r=v.current)?void 0:r.on(e,t)},scrollTo:(e,t)=>{var r;return null==(r=v.current)?void 0:r.scrollTo(e,t)},raf:e=>{var t;return null==(t=v.current)?void 0:t.raf(e)},__lenis:v.current}));const y=h(e=>{a&&w.current!==e&&(w.current=e,document.documentElement.style.pointerEvents=e?"none":"auto")},[a,w]);return B(()=>{"scrollRestoration"in window.history&&(window.history.scrollRestoration=l)},[]),B(()=>{const e=document.documentElement,r=document.body,o=document.body.firstElementChild;let n;if(e.classList.toggle("ScrollRig-scrollHtml",c),r.classList.toggle("ScrollRig-scrollWrapper",c),c&&Object.assign(p,{smoothTouch:!0,wrapper:r,content:o}),v.current=new U(j({orientation:s?"horizontal":"vertical"},p,t?{}:{smoothWheel:!1,syncTouch:!1,smoothTouch:!1})),m)n=m(e=>{var t;return null==(t=v.current)?void 0:t.raf(e)});else{let i;function l(e){var t;null==(t=v.current)||t.raf(e),i=requestAnimationFrame(l)}i=requestAnimationFrame(l),n=()=>cancelAnimationFrame(i)}return()=>{var e;n(),null==(e=v.current)||e.destroy()}},[t]),B(()=>{const e=v.current,t=({scroll:e,limit:t,velocity:r,direction:o,progress:n})=>{const i=s?e:0;u&&(b.y=s?0:e,b.x=i,b.limit=t,b.velocity=r,b.direction=o,b.progress=n||0),Math.abs(r)>1.5&&y(!0),Math.abs(r)<1&&y(!1),d&&d({scroll:e,limit:t,velocity:r,direction:o,progress:n}),g()};return null==e||e.on("scroll",t),u&&(b.scrollDirection=s?"horizontal":"vertical",q.setState({__lenis:e,scrollTo:(...t)=>{null==e||e.scrollTo(...t)},onScroll:t=>(null==e||e.on("scroll",t),null==e||e.emit(),()=>null==e?void 0:e.off("scroll",t))}),q.getState().scroll.y=window.scrollY,q.getState().scroll.x=window.scrollX),null==e||e.emit(),()=>{null==e||e.off("scroll",t),u&&q.setState({__lenis:void 0,onScroll:()=>()=>{},scrollTo:()=>{}})}},[t]),B(()=>{const e=()=>g(),t=()=>y(!1);return window.addEventListener("pointermove",t),window.addEventListener("pointerdown",t),window.addEventListener("wheel",e),()=>{window.removeEventListener("pointermove",t),window.removeEventListener("pointerdown",t),window.removeEventListener("wheel",e)}},[]),r(()=>(u&&(document.documentElement.classList.toggle("js-smooth-scrollbar-enabled",t),document.documentElement.classList.toggle("js-smooth-scrollbar-disabled",!t),q.setState({hasSmoothScrollbar:t})),()=>{document.documentElement.classList.remove("js-smooth-scrollbar-enabled"),document.documentElement.classList.remove("js-smooth-scrollbar-disabled")}),[t]),r(()=>{var e,t;o?null==(e=v.current)||e.stop():null==(t=v.current)||t.start()},[o]),e?e({}):null});var Ve=o(function(t,r){const o=q(e=>e.isCanvasAvailable);return e.createElement(xe,j(o?{key:"r3f",ref:r,invalidate:g,addEffect:b}:{key:"native",ref:r},t))});const Pe={hidden:"ScrollRig-visibilityHidden",hiddenWhenSmooth:"ScrollRig-visibilityHidden ScrollRig-hiddenIfSmooth",transparentColor:"ScrollRig-transparentColor",transparentColorWhenSmooth:"ScrollRig-transparentColor ScrollRig-hiddenIfSmooth"};export{ye as FrameScene,ue as GlobalCanvas,we as ScrollScene,Ve as SmoothScrollbar,Me as UseCanvas,Te as ViewportScrollScene,Pe as styles,Ie as useCanvas,q as useCanvasStore,ke as useImageAsTexture,te as useScrollRig,me as useScrollbar,fe as useTracker};
//# sourceMappingURL=scrollrig.modern.js.map
